{% extends "../../../partials/layout.njk" %}
{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}
{% from "govuk/components/input/macro.njk" import govukInput %}
{% from "govuk/components/date-input/macro.njk" import govukDateInput %}
{% from "govuk/components/radios/macro.njk" import govukRadios %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from 'components/miniBanner/miniBanner.njk' import miniBanner %}
{% set hideBackLink = true %}
{% set breadCrumbs = [
    {
        text: 'Digital Prison Services',
        href:  "/" | prependBaseUrl
    },
    {
        text: miniBannerData.prisonerName,
        href: "/prisoner/" + miniBannerData.prisonerNumber
    },
    {
        text: 'Personal',
        href: "/prisoner/" + miniBannerData.prisonerNumber + "/personal"
    }
] %}
{% set mainClasses = 'govuk-body' %}

{% block content %}

    {% block body %}
        <div class="govuk-grid-row">
            <div class="govuk-grid-column-full">{{ miniBanner(miniBannerData) }}</div>
        </div>

        <h1 class="govuk-heading-l govuk-!-margin-bottom-4">{{ formTitle }}</h1>

        {% if errors.length > 0 %}
            {{ govukErrorSummary({
                titleText: "There is a problem",
                errorList: errors,
                attributes: { 'data-qa-errors': true },
                classes: 'govuk-!-margin-bottom-6'
            }) }}
        {% endif %}

        <div class="hmpps-name-change govuk-grid-row">
            <div class="govuk-grid-column-three-quarters">
                <form method="post" novalidate="novalidate" autocomplete="off">
                    <input type="hidden" name="_csrf" value="{{ csrfToken }}" />

                    {{ govukInput({
                        id: 'firstName',
                        name: 'firstName',
                        label: {
                            text: 'First name',
                            classes: 'govuk-label--s'
                        },
                        value: formValues.firstName,
                        errorMessage: errors | findError('firstName')
                    }) }}

                    {{ govukInput({
                        id: 'middleName1',
                        name: 'middleName1',
                        label: {
                            text: 'Middle name',
                            classes: 'govuk-label--s'
                        },
                        value: formValues.middleName1,
                        errorMessage: errors | findError('middleName1')
                    }) }}

                    {{ govukInput({
                        id: 'middleName2',
                        name: 'middleName2',
                        label: {
                            text: 'Second middle name',
                            classes: 'govuk-label--s'
                        },
                        value: formValues.middleName2,
                        errorMessage: errors | findError('middleName2')
                    }) }}

                    {{ govukInput({
                        id: 'lastName',
                        name: 'lastName',
                        label: {
                            text: 'Last name',
                            classes: 'govuk-label--s'
                        },
                        value: formValues.lastName,
                        errorMessage: errors | findError('lastName')
                    }) }}

                    {% set dayErrorClass = ' govuk-input--error' if (errors | findError("dateOfBirth-day")) or (errors | findError("dateOfBirth")) else '' %}
                    {% set monthErrorClass = ' govuk-input--error' if (errors | findError("dateOfBirth-month")) or (errors | findError("dateOfBirth")) else '' %}
                    {% set yearErrorClass = ' govuk-input--error' if (errors | findError("dateOfBirth-year")) or (errors | findError("dateOfBirth")) else '' %}

                    {{ govukDateInput({
                        id: "dateOfBirth",
                        namePrefix: "dateOfBirth",
                        fieldset: {
                            legend: {
                                text: "Date of birth",
                                classes: "govuk-fieldset__legend--s"
                            }
                        },
                        hint: {
                            text: "For example, 31 8 1980"
                        },
                        items: [
                            {
                                name: "day",
                                attributes: { maxlength: 2 },
                                classes: "govuk-input--width-2" + dayErrorClass,
                                value: formValues['dateOfBirth-day']
                            },
                            {
                                name: "month",
                                attributes: { maxlength: 2 },
                                classes: "govuk-input--width-2" + monthErrorClass,
                                value: formValues['dateOfBirth-month']
                            },
                            {
                                name: "year",
                                attributes: { maxlength: 4 },
                                classes: "govuk-input--width-4" + yearErrorClass,
                                value: formValues['dateOfBirth-year']
                            }
                        ],
                        value: formValues.dateOfBirth,
                        errorMessage: (errors | findError('dateOfBirth'))
                            or (errors | findError('dateOfBirth-day'))
                            or (errors | findError('dateOfBirth-month'))
                            or (errors | findError('dateOfBirth-year'))
                    }) }}

                    {{ govukRadios({
                        name: "sex",
                        fieldset: {
                            legend: {
                                text: "Sex"
                            }
                        },
                        items: [
                            {
                                value: "F",
                                text: "Female",
                                checked: formValues.sex === "F"
                            },
                            {
                                value: "M",
                                text: "Male",
                                checked: formValues.sex === "M"
                            }
                        ]
                    }) }}

                    <div class="govuk-button-group">
                        {{ govukButton({
                            text: "Save",
                            type: "submit",
                            preventDoubleClick: true,
                            attributes: { "data-qa": "edit-submit-button" }
                        }) }}
                        <a href="/prisoner/{{ miniBannerData.prisonerNumber }}/personal#personal-details"
                           class="govuk-link govuk-link--no-visited-state" data-qa="edit-cancel-button">Cancel</a>
                    </div>
                </form>
            </div>
        </div>
    {% endblock %}
{% endblock %}
