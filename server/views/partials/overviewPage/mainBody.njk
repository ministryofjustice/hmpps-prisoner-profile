{% from "./macros/statusListMacro.njk" import statusList %}
{% from "./miniSummaryBoxes/macro.njk" import  miniSummaryMacro %}
{% from "../../components/miniCard/miniCard.njk" import  miniCard %}

<div class="govuk-grid-row">
  <section class="govuk-grid-column-full" aria-label="Status List">
    {{ statusList(statuses) }}
  </section>
</div>

{% if options.showCourtCaseSummary %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      {% include "./courtCases/courtCasesAndReleaseDates.njk" %}
    </div>
  </div>
{% endif %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full" data-qa="overview-mini-summary-group-a">
    <div class="govuk-grid-row hmpps-miniSummaryWrapper" data-qa="mini-summary-list-macro">
      {% if moneySummary and isGranted(PrisonerMoneyPermission.read, prisonerPermissions) %}
        <div class="govuk-grid-column-one-third">
          {{ miniSummaryMacro(moneySummary | toMoneySummaryDisplay(prisonerNumber)) }}
        </div>
      {% endif %}

      {% if visitsSummary and isGranted(PrisonerVisitsAndVisitorsPermission.read, prisonerPermissions) %}
        <div class="govuk-grid-column-one-third">
          {{ miniSummaryMacro(visitsSummary | toVisitsSummaryDisplay(prisonerNumber)) }}
        </div>
      {% endif %}

      {% if nonAssociationSummary %}
        <div class="govuk-grid-column-one-third">
          {{ miniSummaryMacro(nonAssociationSummary | toNonAssociationSummaryDisplay(prisonerNumber), nonAssociationSummary.status != 'fulfilled') }}
        </div>
      {% endif %}
    </div>
  </div>
</div>

<div class="govuk-grid-row hmpps-miniSummaryWrapper">
  {% set showExternalContacts = externalContactsEnabled(prisonId) and
    isGranted(PersonalRelationshipsPermission.read_contacts, prisonerPermissions) %}

  {% call conditionallyShow({
    condition: showExternalContacts,
    id: 'external-contacts',
    visibleClasses: 'govuk-grid-column-one-third'
  }) %}
    {% include "./externalContacts/externalContactsSummary.njk" %}
  {% endcall %}

  <div class="hmpps-full-width-print govuk-grid-column-{% if showExternalContacts %}two-thirds{% else %}full{% endif %}">
    {% if isYouthPrisoner %}
      {% include "./staffContacts/staffContactsYouthEstate.njk" %}
    {% else %}
      {% include "./staffContacts/staffContacts.njk" %}
    {% endif %}
  </div>
</div>

<div class="govuk-grid-row hmpps-miniSummaryWrapper">
  {% if adjudicationSummary and isGranted(PrisonerAdjudicationsPermission.read, prisonerPermissions) %}
    <div class="govuk-grid-column-one-half" data-qa="adjudications-summary">
      {{ miniSummaryMacro(adjudicationSummary | toAdjudicationsSummaryDisplay(prisonerNumber), adjudicationSummary.status != 'fulfilled') }}
    </div>
  {% endif %}

  {% if incentiveSummary and isGranted(PrisonerIncentivesPermission.read_incentive_level, prisonerPermissions) %}
    <div class="govuk-grid-column-one-half">
      {{ miniCard(incentiveSummary | toIncentiveSummaryDisplay(prisonerNumber, prisonerDisplayName, prisonerPermissions), 'mini-card--incentives', incentiveSummary.status != 'fulfilled') }}
    </div>
  {% endif %}
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full" data-qa="overview-mini-summary-group-b">
    <div class="mini-card-wrapper" data-qa="mini-summary-list-macro">
      {% if categorySummary and isGranted(PersonPrisonCategoryPermission.read, prisonerPermissions) %}
        {{ miniCard(categorySummary | toCategorySummaryDisplay(prisonerInCaseLoad, bookingId), 'mini-card--categories') }}
      {% endif %}

      {% set showCsraHistoryLink = isGranted(PrisonerSpecificRisksPermission.read_csra_assessment_history, prisonerPermissions) %}
      {% if csraSummary and isGranted(PrisonerSpecificRisksPermission.read_csra_rating, prisonerPermissions) %}
        {{ miniCard(csraSummary | toCsraSummaryDisplay(showCsraHistoryLink, prisonerNumber), 'mini-card--csra') }}
      {% endif %}

      {% if currentCsipDetail and isGranted(PersonInterventionsPermission.read_csip, prisonerPermissions)  %}
        {{ miniCard(currentCsipDetail | toCsipMiniCardContent(prisonerNumber), 'mini-card--csip') }}
      {% endif %}
    </div>
  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    {% include "./personalDetails/personalDetails.njk" %}
  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    {%- call conditionallyShow({condition: isInUsersCaseLoad(prisonId, user), id: 'overview-schedule'}) -%}
      {% include "./schedule/schedule.njk" %}
    {%- endcall -%}
  </div>
</div>

{% if not options.showCourtCaseSummary %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full" data-qa="overview-offences">
      {% include "./offences/offences.njk" %}
    </div>
  </div>
{% endif %}
