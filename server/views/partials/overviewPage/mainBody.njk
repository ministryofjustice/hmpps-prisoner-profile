{% from "./macros/statusListMacro.njk" import statusList %}
{% from "./miniSummaryBoxes/macro.njk" import  miniSummaryMacro %}
{% from "../../components/miniCard/miniCard.njk" import  miniCard %}

{% set showExternalContacts = externalContactsEnabled(prisonId) and
  isGranted(PersonalRelationshipsPermission.read_contacts, prisonerPermissions) %}

<div class="govuk-grid-row">
  <section class="govuk-grid-column-full" aria-label="Status List">
    {{ statusList(statuses) }}
  </section>
</div>
{% if options.showCourtCaseSummary %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      {% include "./courtCases/courtCasesAndReleaseDates.njk" %}
    </div>
  </div>
{% endif %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full" data-qa="overview-mini-summary-group-a">
    <div class="govuk-grid-row hmpps-miniSummaryWrapper" data-qa="mini-summary-list-macro">
      {% if moneySummary %}
        <div class="govuk-grid-column-one-third">
          {{ miniSummaryMacro(moneySummary | toMoneySummaryDisplay(prisonerNumber)) }}
        </div>
      {% endif %}
      {% if visitsSummary %}
        <div class="govuk-grid-column-one-third">
          {{ miniSummaryMacro(visitsSummary | toVisitsSummaryDisplay(prisonerNumber)) }}
        </div>
      {% endif %}
      {% if nonAssociationSummary %}
        <div class="govuk-grid-column-one-third">
          {{ miniSummaryMacro(nonAssociationSummary | toNonAssociationSummaryDisplay(prisonerNumber), nonAssociationSummary.status != 'fulfilled') }}
        </div>
      {% endif %}
    </div>
  </div>
</div>
<div class="govuk-grid-row hmpps-miniSummaryWrapper">
  {% call conditionallyShow({
    condition: showExternalContacts,
    id: 'external-contacts',
    visibleClasses: 'govuk-grid-column-one-third'
  }) %}
    {% include "./externalContacts/externalContactsSummary.njk" %}
  {% endcall %}
  <div class="hmpps-full-width-print govuk-grid-column-{% if showExternalContacts %}two-thirds{% else %}full{% endif %}">
    {% if isYouthPrisoner %}
      {% include "./staffContacts/staffContactsYouthEstate.njk" %}
    {% else %}
      {% include "./staffContacts/staffContacts.njk" %}
    {% endif %}
  </div>
</div>
<div class="govuk-grid-row hmpps-miniSummaryWrapper">
    {% if adjudicationSummary %}
        <div class="govuk-grid-column-one-half" data-qa="adjudications-summary">
            {{ miniSummaryMacro(adjudicationSummary | toAdjudicationsSummaryDisplay(prisonerNumber), adjudicationSummary.status != 'fulfilled') }}
        </div>
    {% endif %}
    {% if incentiveSummary %}
        <div class="govuk-grid-column-one-half">
            {{ miniCard(incentiveSummary | toIncentiveSummaryDisplay(prisonerNumber, prisonerDisplayName), 'mini-card--incentives', incentiveSummary.status != 'fulfilled') }}
        </div>
    {% endif %}
</div>
<div class="govuk-grid-row">
    <div class="govuk-grid-column-full" data-qa="overview-mini-summary-group-b">
        <div class="mini-card-wrapper" data-qa="mini-summary-list-macro">
            {{ miniCard(categorySummary | toCategorySummaryDisplay(prisonerInCaseLoad, bookingId), 'mini-card--categories') }}
            {{ miniCard(csraSummary | toCsraSummaryDisplay(showCsraHistoryLink, prisonerNumber), 'mini-card--csra') }}
            {% if currentCsipDetail %}
                {{ miniCard(currentCsipDetail | toCsipMiniCardContent(prisonerNumber), 'mini-card--csip') }}
            {% endif %}
        </div>
    </div>
</div>
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    {% include "./personalDetails/personalDetails.njk" %}
  </div>
</div>
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    {%- call conditionallyShow({condition: isInUsersCaseLoad(prisonId, user), id: 'overview-schedule'}) -%}
      {% include "./schedule/schedule.njk" %}
    {%- endcall -%}
  </div>
</div>

{% if not options.showCourtCaseSummary %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full" data-qa="overview-offences">
      {% include "./offences/offences.njk" %}
    </div>
  </div>
{% endif %}
