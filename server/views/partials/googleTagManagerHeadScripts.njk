{% if tagManagerContainerId %}
  <!-- Google Tag Manager -->
  <script nonce="{{ cspNonce }}">window.dataLayer = window.dataLayer || [];</script>

  <!-- Add user details to the dataLayer if present on this page load - for google analytics & tag manager -->
  {% if user %}
    <script nonce="{{ cspNonce }}">window.dataLayer.push({
        'user': {
          'prison': '{{ user.activeCaseLoadId }}',
        },
      })</script>
  {% endif %}

  <script nonce="{{ cspNonce }}">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;var n=d.querySelector('[nonce]');
      n&&j.setAttribute('nonce',n.nonce||n.getAttribute('nonce'));f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','{{ tagManagerContainerId }}');</script>
  <!-- End Google Tag Manager -->
{% endif %}
